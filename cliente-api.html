<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gesti√≥n de Productos y Entidades - MongoDB Atlas</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
            color: #fff;
        }

        body {
            width: 100vw;
            min-height: 100vh;
            background: #081b29;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
        }

        ::-webkit-input-placeholder {
            color: #eee;
        }

        ::-moz-placeholder {
            color: #eee;
        }

        :-ms-input-placeholder {
            color: #eee;
        }

        ::placeholder {
            color: #eee;
        }

        header {
            width: 100%;
            max-width: 1200px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            margin-bottom: 20px;
        }

        .nav-buttons {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .nav-buttons button {
            width: 150px;
            font-size: 18px;
            padding: 10px 0;
            border-radius: 40px;
            background: linear-gradient(45deg, #0ef, #c800ff);
            border: none;
            cursor: pointer;
            transition: transform 0.3s ease, background 0.3s ease, box-shadow 0.3s ease;
        }

        .nav-buttons button:hover {
            transform: scale(1.05);
        }

        .nav-buttons button:active {
            transform: scale(0.95);
        }

        .nav-buttons button.active {
            background: linear-gradient(45deg, #00ff00, #00c4ff);
            box-shadow: 0 0 15px #00ff00, 0 0 30px #00c4ff;
            animation: glow 1.5s ease-in-out infinite alternate;
        }

        @keyframes glow {
            from {
                box-shadow: 0 0 10px #00ff00, 0 0 20px #00c4ff;
            }
            to {
                box-shadow: 0 0 20px #00ff00, 0 0 40px #00c4ff;
            }
        }

        .user-actions {
            display: flex;
            gap: 15px;
        }

        .user-actions button {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            font-size: 16px;
            border-radius: 40px;
            border: 2px solid #0ef;
            background: transparent;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .user-actions button:hover {
            background: #0ef;
            color: #081b29;
        }

        .user-actions button i {
            font-size: 18px;
        }

        .wrapper {
            position: relative;
            width: 95vw;
            max-width: 1200px;
            border: 3px solid #00ffff;
            box-shadow: 0 0 50px 0 #00a6bc;
            display: flex;
            flex-direction: column;
            height: auto;
            min-height: 60vh;
        }

        #register-section.active .wrapper,
        #login-section.active .wrapper {
            max-width: 350px;
        }

        #register-section.active .form,
        #login-section.active .form {
            padding: 20px;
        }

        #register-section.active .title,
        #login-section.active .title {
            font-size: 24px;
        }

        #register-section.active .inp input,
        #login-section.active .inp input {
            font-size: 16px;
        }

        #register-section.active .header .wel_text,
        #login-section.active .header .wel_text {
            font-size: 36px;
            line-height: 40px;
        }

        #register-section.active .header .para,
        #login-section.active .header .para {
            font-size: 16px;
            line-height: 20px;
        }

        #productos-section.active .form,
        #entidades-section.active .form,
        #cloudwords-section.active .form,
        #lemmatize-section.active .form,
        #rpa-section.active .form {
            padding: 50px;
        }

        #productos-section.active .title,
        #entidades-section.active .title,
        #cloudwords-section.active .title,
        #lemmatize-section.active .title,
        #rpa-section.active .title {
            font-size: 36px;
        }

        #productos-section.active .inp input,
        #entidades-section.active .inp input,
        #productos-section.active .inp textarea,
        #entidades-section.active .inp textarea,
        #cloudwords-section.active .inp input,
        #cloudwords-section.active .inp textarea,
        #lemmatize-section.active .inp input,
        #lemmatize-section.active .inp textarea,
        #rpa-section.active .inp input,
        #rpa-section.active .inp textarea {
            font-size: 22px;
        }

        #productos-section.active .header .wel_text,
        #entidades-section.active .header .wel_text,
        #cloudwords-section.active .header .wel_text,
        #lemmatize-section.active .header .wel_text,
        #rpa-section.active .header .wel_text {
            font-size: 52px;
            line-height: 56px;
        }

        #productos-section.active .header .para,
        #entidades-section.active .header .para,
        #cloudwords-section.active .header .para,
        #lemmatize-section.active .header .para,
        #rpa-section.active .header .para {
            font-size: 22px;
            line-height: 26px;
        }

        .header {
            background: linear-gradient(to right, #0ef, #c800ff);
            clip-path: polygon(0 0, 100% 0, 100% 80%, 0 100%);
            padding: 20px;
            text-align: center;
        }

        .header .wel_text {
            font-size: 48px;
            line-height: 50px;
        }

        .header .para {
            margin-top: 10px;
            font-size: 20px;
            line-height: 24px;
            letter-spacing: 1px;
        }

        .form {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 30px;
            height: auto;
            min-height: 300px;
        }

        #productos-section .form, 
        #entidades-section .form,
        #cloudwords-section .form,
        #lemmatize-section .form,
        #rpa-section .form {
            justify-content: start;
        }

        .title {
            font-size: 30px;
            margin-bottom: 20px;
            text-align: center;
        }

        .inp {
            position: relative;
            padding-bottom: 10px;
            border-bottom: 2px solid #eee;
            margin-bottom: 20px;
            width: 100%;
        }

        .inp input, .inp textarea, .inp select {
            border: none;
            outline: none;
            background: none;
            width: 100%;
            padding-right: 40px;
            font-size: 18px;
            color: #0ef;
        }

        .inp textarea {
            min-height: 120px;
            resize: vertical;
        }

        .inp i {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: #0ef;
            font-size: 18px;
        }

        button {
            border: none;
            outline: none;
            width: 100%;
            margin-top: 20px;
            padding: 12px 0;
            font-size: 20px;
            border-radius: 40px;
            letter-spacing: 1px;
            cursor: pointer;
            background: linear-gradient(45deg, #0ef, #c800ff);
            transition: transform 0.3s ease;
        }

        button:hover {
            transform: scale(1.05);
        }

        button:active {
            transform: scale(0.95);
        }

        button.back {
            background: transparent;
            border: 2px solid #0ef;
            margin-top: 25px;
            width: 300px;
            font-size: 22px;
        }

        button.back:hover {
            background: #0ef;
            color: #081b29;
        }

        .footer {
            margin-top: 30px;
            letter-spacing: 0.5px;
            font-size: 16px;
            text-align: center;
        }

        .link {
            color: #0ef;
            text-decoration: none;
        }

        .link:hover {
            text-decoration: underline;
        }

        .content-section {
            display: none;
            flex: 1;
            flex-direction: column;
            height: auto;
        }

        .content-section.active {
            display: flex;
        }

        .alert {
            padding: 12px 15px;
            margin-top: 15px;
            font-size: 16px;
            text-align: center;
            width: 100%;
        }

        .alert-success {
            color: #27ae60;
        }

        .alert-error {
            color: #e74c3c;
        }

        #productos-list, #entidades-list {
            margin-top: 15px;
            width: 100%;
        }

        .producto-card, .entidad-chip {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 0;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .entidad-chip {
            background: none;
            padding: 0;
        }

        .entidad-chip > div {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            border-top: none;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .entidad-chip > button.back {
            grid-column: 1 / -1;
            width: 100%;
            max-width: 300px;
            margin: 20px auto 0;
        }

        .producto-card p, .entidad-chip p {
            margin: 8px 0;
            font-size: 18px;
        }

        .producto-card strong, .entidad-chip strong {
            color: #0ef;
        }

        .producto-card small, .entidad-chip small {
            color: #eee;
            font-size: 16px;
        }

        .producto-card button, .entidad-chip button {
            margin-top: 10px;
            padding: 10px 20px;
            font-size: 16px;
            width: 100%;
        }

        .entidad-chip > span {
            font-size: 22px;
            font-weight: 500;
            color: #0ef;
            display: block;
            margin-bottom: 15px;
        }

        .product-columns {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 50px;
            padding: 50px;
            width: 100%;
            height: auto;
            align-items: start;
        }

        .column {
            display: flex;
            flex-direction: column;
            align-items: start;
            width: 100%;
        }

        .create-product, .list-products, .create-entity, .list-entities, .scrape-section {
            width: 100%;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid #00ffff;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
        }

        .list-products #productos-list, .list-entities #entidades-list {
            margin-top: 10px;
            width: 100%;
        }

        .create-product .inp,
        .list-products .inp,
        .create-entity .inp,
        .list-entities .inp,
        .scrape-section .inp,
        .create-product button,
        .list-products button,
        .create-entity button,
        .list-entities button,
        .scrape-section button {
            width: 100%;
            max-width: none;
        }

        .list-products .alert, .list-entities .alert, .scrape-section .alert {
            width: 100%;
            max-width: none;
        }

        .tabs-container {
            display: flex;
            width: 100%;
            margin-top: 20px;
            gap: 20px;
        }

        .tabs {
            display: flex;
            flex-direction: column;
            gap: 10px;
            width: 200px;
        }

        .tab {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid #0ef;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
            text-align: left;
        }

        .tab:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .tab.active {
            background: linear-gradient(45deg, #0ef, #c800ff);
            border-color: #00ff00;
            box-shadow: 0 0 10px #0ef;
        }

        .tabs-content {
            flex: 1;
            width: 100%;
        }

        .tab-content {
            display: none;
            width: 100%;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .tab-content.active {
            display: grid;
        }

        @media (max-width: 768px) {
            .tabs-container {
                flex-direction: column;
            }

            .tabs {
                width: 100%;
                flex-direction: row;
                overflow-x: auto;
                white-space: nowrap;
            }

            .tab {
                flex: 0 0 auto;
            }

            .tabs-content {
                width: 100%;
            }

            .tab-content {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            }

            .product-columns {
                grid-template-columns: 1fr;
            }
        }

        #main-nav {
            display: none;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <header id="main-nav">
        <div class="nav-buttons">
            <button id="productos-btn" onclick="showSection('productos')">Productos</button>
            <button id="entidades-btn" onclick="showSection('entidades')">Entidades</button>
            <button id="scraping-btn" onclick="showSection('scraping')">Scraping</button>
            <button id="cloudwords-btn" onclick="showSection('cloudwords')">Nube Palabras</button>
            <button id="lemmatize-btn" onclick="showSection('lemmatize')">Lematizaci√≥n</button>
            <button id="rpa-btn" onclick="showSection('rpa')">RPA</button>
 
    </div>
        <div class="user-actions">
            <button id="profile-btn"><i class="fa-solid fa-user"></i> Admin</button>
            <button onclick="logout()"><i class="fa-solid fa-sign-out-alt"></i> Cerrar Sesi√≥n</button>
        </div>
    </header>

    <div class="wrapper">
        <div id="register-section" class="content-section">
            <div class="header">
                <h1 class="wel_text">BIENVENIDO</h1>
                <p class="para">Gesti√≥n de Productos<br />y Entidades<br />MongoDB Atlas</p>
            </div>
            <form class="form">
                <h1 class="title">Registro</h1>
                <div class="inp">
                    <input type="email" id="register-email" class="input" placeholder="Email">
                    <i class="fa-solid fa-envelope"></i>
                </div>
                <div class="inp">
                    <input type="password" id="register-password" class="input" placeholder="Contrase√±a">
                    <i class="fa-solid fa-lock"></i>
                </div>
                <button type="button" onclick="register()">Registrar</button>
                <p class="footer">¬øYa tienes una cuenta? <a href="#" class="link" onclick="showSection('login'); return false;">Inicia Sesi√≥n</a></p>
                <div id="register-result" class="alert"></div>
            </form>
        </div>

        <div id="login-section" class="content-section">
            <div class="header">
                <h1 class="wel_text">BIENVENIDO</h1>
                <p class="para">Gesti√≥n de Productos<br />y Entidades<br />MongoDB Atlas</p>
            </div>
            <form class="form">
                <h1 class="title">Inicio</h1>
                <div class="inp">
                    <input type="email" id="login-email" class="input" placeholder="Email" required>
                    <i class="fa-solid fa-envelope"></i>
                </div>
                <div class="inp">
                    <input type="password" id="login-password" class="input" placeholder="Contrase√±a" required>
                    <i class="fa-solid fa-lock"></i>
                </div>
                <button type="button" onclick="login()">Iniciar Sesi√≥n</button>
                <button type="button" class="back" onclick="showSection('register')">Regresar</button>
                <p class="footer">¬øNo tienes una cuenta? <a href="#" class="link" onclick="showSection('register'); return false;">Reg√≠strate</a></p>
                <div id="login-result" class="alert"></div>
            </form>
        </div>

        <div id="productos-section" class="content-section">
            <div class="header">
                <h1 class="wel_text">PRODUCTOS</h1>
                <p class="para">Gesti√≥n de Productos<br />y Entidades<br />MongoDB Atlas</p>
            </div>
            <div class="form product-columns">
                <div class="column create-product">
                    <h1 class="title">Crear Producto</h1>
                    <div class="inp">
                        <input type="text" id="create-product-name" class="input" placeholder="Nombre">
                    </div>
                    <div class="inp">
                        <textarea id="create-product-description" class="input" placeholder="Descripci√≥n (opcional)"></textarea>
                    </div>
                    <div class="inp">
                        <input type="number" id="create-product-price" step="0.01" min="0" class="input" placeholder="Precio">
                    </div>
                    <button type="button" onclick="createProducto()">Crear Producto</button>
                    <div id="create-product-result" class="alert"></div>
                </div>
                <div class="column list-products">
                    <h1 class="title">Lista de Productos</h1>
                    <button type="button" class="back" onclick="initializeProductosTabs()">Actualizar</button>
                    <div class="tabs-container">
                        <div class="tabs" id="productos-tabs"></div>
                        <div class="tabs-content" id="productos-list"></div>
                    </div>
                </div>
            </div>
        </div>

        <div id="entidades-section" class="content-section">
            <div class="header">
                <h1 class="wel_text">ENTIDADES</h1>
                <p class="para">Gesti√≥n de Productos<br />y Entidades<br />MongoDB Atlas</p>
            </div>
            <div class="form product-columns">
                <div class="column create-entity">
                    <h1 class="title">Crear Entidad</h1>
                    <div class="inp">
                        <input type="text" id="entity-collection" class="input" placeholder="Colecci√≥n">
                    </div>
                    <div class="inp">
                        <input type="text" id="entity-name" class="input" placeholder="Nombre del Registro">
                    </div>
                    <div class="inp">
                        <textarea id="create-entity-description" class="input" placeholder="Descripci√≥n (opcional)"></textarea>
                    </div>
                    <button type="button" onclick="createEntidad()">Crear Registro</button>
                    <div id="create-entity-result" class="alert"></div>
                </div>
                <div class="column list-entities">
                    <h1 class="title">Lista de Entidades</h1>
                    <button type="button" class="back" onclick="getEntidades()">Actualizar Lista</button>
                    <div class="tabs-container">
                        <div class="tabs" id="entidades-tabs"></div>
                        <div class="tabs-content" id="entidades-list"></div>
                    </div>
                </div>
               
            </div>
        </div>

        <!-- NUEVAS SECCIONES -->
                <div id="scraping-section" class="content-section">
                <div class="header">
                    <h1 class="wel_text">SCRAPING DE DATOS</h1>
                    <p class="para">Extracci√≥n de Informaci√≥n<br />de Sitios Web<br />MongoDB Atlas</p>
                </div>
                <div class="form">
                    <div class="create-product" style="width: 100%; max-width: 800px; margin: 0 auto;">
                        <h1 class="title">Scraping de Datos</h1>
                        <div class="inp">
                            <input type="text" id="scrape-url" class="input" placeholder="URL a scrapear">
                        </div>
                        <button type="button" onclick="scrapeWebsite()">Scrapear y Descargar</button>
                        <div id="scrape-result" class="alert"></div>
                    </div>
                </div>
            </div>



                <div id="cloudwords-section" class="content-section">
                <div class="header">
                    <h1 class="wel_text">NUBE DE PALABRAS</h1>
                    <p class="para">An√°lisis de Textos<br />y Colecciones<br />MongoDB Atlas</p>
                </div>
                <div class="form">
                    <div class="create-product" style="width: 100%; max-width: 800px; margin: 0 auto;">
                        <h1 class="title">Generar Nube de Palabras</h1>
                        <div class="inp">
                            <textarea id="cloudwords-text" class="input" placeholder="Escribe o pega el texto para analizar" rows="8"></textarea>
                        </div>
                        <button type="button" onclick="generateWordcloud()">Generar Nube de Palabras</button>
                        <div id="cloudwords-result" class="alert"></div>
                        <div id="cloudwords-result-container"></div>
                    </div>
                </div>
            </div>

        <div id="lemmatize-section" class="content-section">
    <div class="header">
        <h1 class="wel_text">LEMATIZACI√ìN</h1>
        <p class="para">An√°lisis de Textos<br />MongoDB Atlas</p>
    </div>
    <div class="form">
        <div class="create-product" style="width: 100%; max-width: 800px; margin: 0 auto;">
            <h1 class="title">Lematizar Texto</h1>
            <div class="inp">
                <textarea id="lemmatize-text" class="input" placeholder="Escribe o pega el texto para lematizar" rows="6"></textarea>
            </div>
            <div class="inp">
                <select id="lemmatize-language" class="input">
                    <option value="spanish">Espa√±ol</option>
                    <option value="english">Ingl√©s</option>
                </select>
            </div>
            <div style="display: flex; align-items: center; margin-bottom: 20px;">
                <input type="checkbox" id="lemmatize-remove-stopwords" checked style="margin-right: 10px; width: auto;">
                <label for="lemmatize-remove-stopwords" style="color: #0ef;">Eliminar stopwords</label>
            </div>
            <button type="button" onclick="lemmatizeText()">Lematizar Texto</button>
            <div id="lemmatize-result" class="alert"></div>
            <div id="lemmatize-result-container"></div>
        </div>
    </div>
</div>
               
                    
                    
                </div>
            </div>
        </div>

      <!-- Reemplaza el contenido de la secci√≥n RPA en cliente-api.html con este c√≥digo -->
<!-- Reemplaza la secci√≥n actual de automatizaci√≥n de Office con esta versi√≥n simplificada -->

<!-- Reemplaza la secci√≥n actual de automatizaci√≥n de Office con esta versi√≥n simplificada -->
<style>
/* Reset completo para la secci√≥n RPA */
.wrapper, #rpa-section .wrapper {
    position: static !important;
    width: auto !important;
    border: none !important;
    box-shadow: none !important;
    background: none !important;
    margin: 0 !important;
    padding: 0 !important;
}

#rpa-section {
    border: none !important;
    box-shadow: none !important;
    background: #081b29 !important;
    margin: 0 !important;
    padding: 0 !important;
    position: relative !important;
    top: -350px !important; /* Valor extremadamente agresivo */
    margin-bottom: -320px !important; /* Compensar el espacio vac√≠o */
}

#rpa-section .header {
    background: linear-gradient(to right, #0ef, #c800ff);
    clip-path: none !important;
    border: none !important;
    box-shadow: none !important;
    margin: 0 !important;
    padding: 10px 20px !important;
    position: relative !important;
    top: -70px !important; /* Subir mucho m√°s */
    z-index: 100 !important;
    display: block !important;
    visibility: visible !important;
}

#rpa-section .wel_text {
    margin: 0 !important;
    padding: 0 !important;
    font-size: 28px !important;
    line-height: 1.2 !important;
    display: block !important;
    visibility: visible !important;
    color: white !important;
}

#rpa-section .para {
    display: block !important; /* Mostrar el subt√≠tulo */
    visibility: visible !important;
    margin-top: 5px !important;
    font-size: 16px !important;
    color: white !important;
}

#rpa-section .form {
    border: none !important;
    box-shadow: none !important;
    background: none !important;
    padding: 10px 20px 20px !important;
    margin-top: 5px !important;
    position: relative !important;
    z-index: 90 !important;
}

#rpa-section .create-product {
    background: rgba(0, 0, 0, 0.2) !important;
    border-radius: 15px !important;
    padding: 20px !important;
    border: 1px solid rgba(0, 255, 255, 0.1) !important;
    box-shadow: none !important;
    margin-top: 10px !important;
    position: relative !important;
    z-index: 100 !important;
}

/* Eliminar cualquier borde/marco adicional */
body > div.wrapper {
    border: none !important;
    box-shadow: none !important;
}

/* Hacer t√≠tulo m√°s compacto pero visible */
#rpa-section .title {
    margin-top: 0 !important;
    margin-bottom: 15px !important;
    font-size: 24px !important;
    display: block !important;
    visibility: visible !important;
    color: #0ef !important;
    text-align: center !important;
}

/* Asegurar que todos los elementos importantes sean visibles */
h1, h2, h3, .title, .wel_text, .para {
    display: block !important;
    visibility: visible !important;
}
</style>

<div id="rpa-section" class="content-section">
    <div class="header">
        <h1 class="wel_text">AUTOMATIZACI√ìN (RPA)</h1>
        <p class="para">Robotic Process Automation</p>
    </div>
    <div class="form" style="border: none !important; box-shadow: none !important;">
        <!-- Secci√≥n simplificada para RPA -->
        <div class="create-product" style="width: 100%; max-width: 600px; margin: 0 auto; border: none; box-shadow: none;">
            <h1 class="title">Automatizaci√≥n de Office</h1>
            
            <!-- Mensaje de notificaci√≥n sobre proceso visible -->
            <div style="background: rgba(14, 255, 255, 0.1); border-radius: 10px; padding: 10px; margin-bottom: 20px; border-left: 3px solid #0ef;">
                <p style="margin: 0; color: #0ef;">
                    <i class="fa-solid fa-info-circle"></i> 
                    <strong>Importante:</strong> Durante el proceso se abrir√° la aplicaci√≥n seleccionada. <strong>No cierres ni interact√∫es</strong> con la aplicaci√≥n hasta que termine la automatizaci√≥n.
                </p>
            </div>
            
            <!-- Selecci√≥n de aplicaci√≥n simplificada -->
            <div style="margin-bottom: 30px; text-align: center;">
                <h3 style="color: #0ef; margin-bottom: 20px; font-size: 20px;">Seleccione la aplicaci√≥n para automatizar:</h3>
                <div style="display: flex; justify-content: center; gap: 40px; margin-bottom: 20px;">
                    <div style="text-align: center;">
                        <input type="radio" id="office-excel" name="office-app" value="excel" style="transform: scale(1.5); margin-bottom: 10px;">
                        <br>
                        <label for="office-excel" style="color: #0ef; font-size: 18px;">Excel</label>
                    </div>
                    <div style="text-align: center;">
                        <input type="radio" id="office-word" name="office-app" value="word" checked style="transform: scale(1.5); margin-bottom: 10px;">
                        <br>
                        <label for="office-word" style="color: #0ef; font-size: 18px; font-weight: bold;">Word</label>
                    </div>
                    <div style="text-align: center;">
                        <input type="radio" id="office-powerpoint" name="office-app" value="powerpoint" style="transform: scale(1.5); margin-bottom: 10px;">
                        <br>
                        <label for="office-powerpoint" style="color: #0ef; font-size: 18px;">PowerPoint</label>
                    </div>
                </div>
                <div style="background: rgba(0, 238, 255, 0.1); display: inline-block; padding: 5px 15px; border-radius: 20px;">
                    <span style="color: #0ef; font-size: 14px;">Word preseleccionado para mayor visibilidad del proceso</span>
                </div>
            </div>
            
            <!-- Ruta de guardado opcional -->
            <div class="inp">
                <input type="text" id="office-file-path" class="input" placeholder="Ruta para guardar (Opcional - si se deja vac√≠o se guardar√° en el Escritorio)">
                <small style="display: block; margin-top: 5px; color: #0ef;">Ejemplo: C:\Users\MiUsuario\Desktop\documento_nuevo.xlsx</small>
            </div>
            
            <!-- Configuraci√≥n espec√≠fica de la aplicaci√≥n -->
            <div id="excel-params" style="margin-top: 20px; display: none;">
                <h3 style="color: #0ef; margin-bottom: 10px;">Opciones de Excel:</h3>
                <div class="inp">
                    <input type="text" id="excel-sheet-name" class="input" placeholder="Nombre de la hoja (opcional)">
                </div>
            </div>
            
            <!-- Opciones avanzadas (desplegable) -->
            <div style="margin-top: 20px;">
                <button type="button" onclick="toggleAdvancedOptions()" style="background: none; border: 1px solid #0ef; color: #0ef; padding: 8px 15px; border-radius: 5px; cursor: pointer; width: auto; margin: 0;">
                    <i class="fa-solid fa-cog"></i> Opciones avanzadas
                </button>
                
                <div id="advanced-options" style="display: none; margin-top: 15px; background: rgba(0,0,0,0.1); padding: 15px; border-radius: 10px;">
                    <div style="margin-bottom: 15px;">
                        <label for="visible-process-checkbox" style="display: flex; align-items: center; color: #0ef; cursor: pointer;">
                            <input type="checkbox" id="visible-process-checkbox" checked style="margin-right: 10px; transform: scale(1.2);">
                            <span>Mostrar proceso en pantalla (ver c√≥mo se abre y usa la aplicaci√≥n)</span>
                        </label>
                    </div>
                    
                    <div>
                        <label for="slow-mode-checkbox" style="display: flex; align-items: center; color: #0ef; cursor: pointer;">
                            <input type="checkbox" id="slow-mode-checkbox" checked style="margin-right: 10px; transform: scale(1.2);">
                            <span>Modo lento (mejor para ver cada paso)</span>
                        </label>
                    </div>
                </div>
            </div>
            
            <script>
            function toggleAdvancedOptions() {
                const advancedOptions = document.getElementById('advanced-options');
                advancedOptions.style.display = advancedOptions.style.display === 'none' ? 'block' : 'none';
            }
            </script>
            
            <div id="office-automation-progress" style="display: none; margin-top: 20px; background: rgba(0,0,0,0.2); border-radius: 10px; padding: 15px;">
                <h3 style="color: #0ef; margin-bottom: 10px;">Progreso:</h3>
                <div id="progress-steps" style="margin-left: 20px;">
                    <p id="step1" style="margin: 8px 0; color: #aaa;"><i class="fa-solid fa-circle-notch"></i> Iniciando aplicaci√≥n...</p>
                    <p id="step2" style="margin: 8px 0; color: #aaa;"><i class="fa-solid fa-circle-notch"></i> Creando documento...</p>
                    <p id="step3" style="margin: 8px 0; color: #aaa;"><i class="fa-solid fa-circle-notch"></i> Guardando archivo...</p>
                    <p id="step4" style="margin: 8px 0; color: #aaa;"><i class="fa-solid fa-circle-notch"></i> Finalizando proceso...</p>
                </div>
                <div style="background: rgba(14, 255, 255, 0.05); border-radius: 5px; padding: 8px; margin-top: 15px; font-size: 14px; color: #0ef; text-align: center;">
                    <i class="fa-solid fa-info-circle"></i> Es posible que necesites cambiar a la ventana de Office que se abrir√° durante el proceso.
                </div>
            </div>
            
            <div style="background: #ff3333; color: white; padding: 20px; border-radius: 10px; margin: 20px 0; text-align: center; font-weight: bold; font-size: 16px;">
                ‚ö†Ô∏è ATENCI√ìN IMPORTANTE ‚ö†Ô∏è<br>
                <span style="font-size: 14px; display: block; margin-top: 10px;">
                    Para ver el proceso de Word, es necesario revisar la configuraci√≥n del backend RPA.<br>
                    Es posible que el servicio de RPA no est√© configurado para mostrar las ventanas de la aplicaci√≥n.<br>
                    Contacta con el administrador del sistema para verificar la implementaci√≥n de PyAutoGUI.
                </span>
            </div>
            
            <!-- Mensaje que muestra el c√≥digo backend necesario -->
            <div style="margin-top: 20px; background: #002b36; border-radius: 10px; padding: 15px; border: 1px solid #0ef; overflow: auto;">
                <h3 style="color: #0ef; margin-top: 0;">C√≥digo de backend requerido (services/rpa_service.py):</h3>
                <pre style="color: #93a1a1; margin: 0; font-family: monospace; font-size: 13px; line-height: 1.4;">
import pyautogui
import subprocess
import time
import os

# Configurar pausa entre acciones de pyautogui para mayor estabilidad
pyautogui.PAUSE = 0.5
# Configuraci√≥n segura - permite mover el mouse a la esquina para abortar
pyautogui.FAILSAFE = True

def rpa_escribir_en_word(texto, ruta_guardado=None):
    """Automatiza la apertura de Word, escritura de texto y guardado."""
    try:
        # Abrir Microsoft Word en Windows
        subprocess.run("start winword", shell=True)
        time.sleep(5)  # Esperar a que Word se abra completamente

        # Crear un nuevo documento (Ctrl + N en Word en ingl√©s, Ctrl + U en espa√±ol)
        pyautogui.hotkey('ctrl', 'n')
        time.sleep(2)  # Esperar a que el documento se cree

        # Escribir el texto en el documento
        pyautogui.write(texto, interval=0.05)
        time.sleep(1)

        # Guardar el documento
        pyautogui.hotkey('ctrl', 'g')  # Ctrl+G en espa√±ol (Guardar)
        time.sleep(1)
        
        # Si se especific√≥ una ruta, escribirla
        if ruta_guardado:
            pyautogui.write(ruta_guardado)
            time.sleep(0.5)
        
        pyautogui.press('enter')
        time.sleep(2)

        # Cerrar Word
        pyautogui.hotkey('alt', 'f4')
        time.sleep(1)
        # Si pregunta por guardar cambios, aceptar
        pyautogui.press('s')  # 'S' para "S√≠" en espa√±ol
        
        print(f"RPA completado: Texto escrito y documento guardado en Word.")
        return True
        
    except Exception as e:
        print(f"Error durante la automatizaci√≥n de Word: {e}")
        return False
                </pre>
            </div>
            
            <!-- Bot√≥n de ejecuci√≥n -->
            <button type="button" id="execute-rpa-btn" onclick="executeSimplifiedRPA()" style="margin-top: 30px; height: 60px; font-size: 22px; background: linear-gradient(45deg, #0ef, #c800ff);">
                Ejecutar Automatizaci√≥n de Office
            </button>
            
            <div id="office-automation-result" class="alert"></div>
        </div>
    </div>
</div>

<script>
// Mostrar/ocultar par√°metros espec√≠ficos seg√∫n la aplicaci√≥n seleccionada
document.addEventListener('DOMContentLoaded', function() {
    // Agregar listeners a los radio buttons
    const appRadios = document.querySelectorAll('input[name="office-app"]');
    appRadios.forEach(radio => {
        radio.addEventListener('change', updateAppParams);
    });
    
    // Inicializar
    updateAppParams();
});

function updateAppParams() {
    const selectedApp = document.querySelector('input[name="office-app"]:checked').value;
    
    // Ocultar todos los par√°metros espec√≠ficos
    document.getElementById('excel-params').style.display = 'none';
    
    // Mostrar los par√°metros correspondientes
    if (selectedApp === 'excel') {
        document.getElementById('excel-params').style.display = 'block';
    }
}

// Funci√≥n para ejecutar la automatizaci√≥n simplificada
function executeSimplifiedRPA() {
    // Obtener la aplicaci√≥n seleccionada
    const selectedApp = document.querySelector('input[name="office-app"]:checked').value;
    const filePath = document.getElementById('office-file-path').value.trim();
    const visibleProcess = document.getElementById('visible-process-checkbox').checked;
    const slowMode = document.getElementById('slow-mode-checkbox').checked;
    
    // Mostrar indicador de carga
    showAlert('office-automation-result', 'Ejecutando automatizaci√≥n...', 'success');
    
    // Desactivar bot√≥n durante la ejecuci√≥n
    const executeBtn = document.getElementById('execute-rpa-btn');
    executeBtn.disabled = true;
    executeBtn.textContent = "Ejecutando...";
    
    // Mostrar progreso
    const progressDiv = document.getElementById('office-automation-progress');
    progressDiv.style.display = 'block';
    
    // Marcar primer paso como en progreso
    document.getElementById('step1').innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> <span style="color: #0ef;">Iniciando aplicaci√≥n...</span>';
    
    // Configurar par√°metros con m√°ximo detalle para forzar visibilidad
    let params = {
        app: selectedApp,
        action: "create",
        file_path: filePath,
        visible_process: true,      // Hacer visible el proceso de creaci√≥n
        slow_mode: true,            // Modo lento para ver mejor el proceso
        wait_time: 10000,           // 10 segundos entre acciones - muy lento para poder ver
        debug_mode: true,           // Activar modo de depuraci√≥n si existe
        foreground_window: true,    // Intentar mantener la ventana en primer plano
        show_steps: true,           // Mostrar pasos detallados
        disable_headless: true,     // Desactivar cualquier modo sin interfaz
        pyautogui_mode: true        // Usar PyAutoGUI si es posible (m√°s visual)
    };
    
    // Contenido predeterminado seg√∫n la aplicaci√≥n
    if (selectedApp === 'excel') {
        // Datos de ejemplo para plantilla Excel (estructura simple de tabla)
        params.data = "T√≠tulo,Valor\nEjemplo 1,100\nEjemplo 2,200\nEjemplo 3,300";
        params.sheet_name = document.getElementById('excel-sheet-name').value || "Plantilla";  // Nombre personalizado para la hoja
    } else if (selectedApp === 'word') {
        params.content = "Este es un documento creado autom√°ticamente mediante RPA.\n\nLa automatizaci√≥n rob√≥tica de procesos (RPA) permite crear documentos de manera autom√°tica sin intervenci√≥n manual.";
        // Par√°metros adicionales espec√≠ficos para Word
        params.open_method = "subprocess";  // Usar subprocess.run para abrir Word
        params.command = "start winword";   // Comando espec√≠fico para abrir Word
        params.use_hotkeys = true;         // Usar atajos de teclado para operaciones
        params.min_wait_time = 5000;       // Tiempo m√≠nimo de espera para operaciones
        params.delay_between_keys = 100;   // Milisegundos entre pulsaciones de teclas
        params.open_timeout = 10000;       // Tiempo de espera para que Word se abra
    } else if (selectedApp === 'powerpoint') {
        params.title = "Presentaci√≥n Autom√°tica";
        params.slides = "Automatizaci√≥n RPA|La automatizaci√≥n rob√≥tica de procesos permite crear presentaciones de manera eficiente sin intervenci√≥n manual.";
    }
    
    // Simular progreso
    setTimeout(() => {
        // Paso 1 completado
        document.getElementById('step1').innerHTML = '<i class="fa-solid fa-check"></i> <span style="color: #0ef;">Aplicaci√≥n iniciada</span>';
        // Paso 2 en progreso
        document.getElementById('step2').innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> <span style="color: #0ef;">Creando documento...</span>';
        
        setTimeout(() => {
            // Paso 2 completado
            document.getElementById('step2').innerHTML = '<i class="fa-solid fa-check"></i> <span style="color: #0ef;">Documento creado</span>';
            // Paso 3 en progreso
            document.getElementById('step3').innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> <span style="color: #0ef;">Guardando archivo...</span>';
            
            // Llamar a la API
            fetchWithRefresh('http://127.0.0.1:8000/rpa/office-automation', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(params)
            })
            .then(response => {
                if (!response.ok) {
                    return response.text().then(text => {
                        throw new Error(text);
                    });
                }
                return response.json();
            })
            .then(result => {
                // Paso 3 completado
                document.getElementById('step3').innerHTML = '<i class="fa-solid fa-check"></i> <span style="color: #0ef;">Archivo guardado</span>';
                // Paso 4 en progreso
                document.getElementById('step4').innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> <span style="color: #0ef;">Finalizando proceso...</span>';
                
                setTimeout(() => {
                    // Paso 4 completado
                    document.getElementById('step4').innerHTML = '<i class="fa-solid fa-check"></i> <span style="color: #0ef;">Proceso finalizado</span>';
                    
                    // Mostrar mensaje de √©xito
                    showAlert('office-automation-result', `¬°Automatizaci√≥n completada exitosamente para ${selectedApp.toUpperCase()}!`, 'success');
                    
                    // Mostrar detalles
                    const resultContainer = document.getElementById('office-automation-result');
                    const detailsDiv = document.createElement('div');
                    detailsDiv.classList.add('producto-card');
                    detailsDiv.style.marginTop = '15px';
                    detailsDiv.innerHTML = `
                        <p><strong>Estado:</strong> <span style="color: #4CAF50;">‚úì Completado</span></p>
                        <p><strong>Aplicaci√≥n:</strong> ${selectedApp.toUpperCase()}</p>
                        <p><strong>Archivo guardado en:</strong> ${result.details ? result.details.replace('Archivo guardado en: ', '') : 'Ubicaci√≥n por defecto'}</p>
                        <p><small>Se ha creado una plantilla b√°sica, guardado y cerrado la aplicaci√≥n autom√°ticamente.</small></p>
                    `;
                    
                    resultContainer.parentNode.insertBefore(detailsDiv, resultContainer.nextSibling);
                    
                    // Habilitar el bot√≥n nuevamente
                    executeBtn.disabled = false;
                    executeBtn.textContent = "Ejecutar Automatizaci√≥n de Office";
                }, 1500);
            })
            .catch(error => {
                console.error('Error en automatizaci√≥n:', error);
                
                // Marcar todos los pasos como error
                document.getElementById('step3').innerHTML = '<i class="fa-solid fa-times"></i> <span style="color: #ff5555;">Error al guardar archivo</span>';
                document.getElementById('step4').innerHTML = '<i class="fa-solid fa-times"></i> <span style="color: #ff5555;">Proceso interrumpido</span>';
                
                showAlert('office-automation-result', `Error: ${error.message}`, 'error');
                
                // Sugerencia para el error com√∫n de permisos
                if (error.message.includes('Permission denied')) {
                    const resultContainer = document.getElementById('office-automation-result');
                    const errorHelp = document.createElement('div');
                    errorHelp.classList.add('producto-card');
                    errorHelp.style.marginTop = '15px';
                    errorHelp.style.backgroundColor = 'rgba(255, 100, 100, 0.1)';
                    errorHelp.style.borderLeft = '3px solid #ff5555';
                    errorHelp.innerHTML = `
                        <p><strong>Error de permisos:</strong> No se puede guardar en la ubicaci√≥n especificada.</p>
                        <p>Sugerencias:</p>
                        <ul style="padding-left: 20px; margin-top: 5px;">
                            <li>Deje el campo de ruta vac√≠o para guardar en el Escritorio</li>
                            <li>Use una ruta donde tenga permisos (ej: C:\\Users\\SuUsuario\\Documents\\archivo.docx)</li>
                            <li>No utilice rutas de sistema como Program Files</li>
                        </ul>
                    `;
                    
                    resultContainer.parentNode.insertBefore(errorHelp, resultContainer.nextSibling);
                }
                
                // Habilitar el bot√≥n nuevamente
                executeBtn.disabled = false;
                executeBtn.textContent = "Ejecutar Automatizaci√≥n de Office";
            });
        }, 2000);
    }, 1500);
}
</script>
    <script>
        const API_BASE_PRODUCTOS = "http://127.0.0.1:8000/productos";
        const API_BASE_ENTIDADES = "http://127.0.0.1:8000/entidades";
        let accessToken = localStorage.getItem('accessToken') || null;


        
        function generateSafeId(name) {
            return name
                .toLowerCase()
                .replace(/\s+/g, '-') // Reemplazar espacios por guiones
                .replace(/[^a-z0-9-]/g, ''); // Eliminar caracteres no alfanum√©ricos
        }

        function showAlert(elementId, message, type = 'success') {
            const element = document.getElementById(elementId);
            element.innerHTML = message;
            element.className = `alert alert-${type}`;
            setTimeout(() => element.innerHTML = '', 5000);
        }

        function showTab(section, tabId) {
            console.log(`showTab called with section: ${section}, tabId: ${tabId}`);
            const tabs = document.querySelectorAll(`#${section}-tabs .tab`);
            const contents = document.querySelectorAll(`#${section}-list .tab-content`);

            tabs.forEach(tab => tab.classList.remove('active'));
            contents.forEach(content => content.classList.remove('active'));

            const selectedTab = Array.from(tabs).find(tab => tab.getAttribute('data-tab-id') === tabId);
            const selectedContent = document.getElementById(tabId);

            if (selectedTab && selectedContent) {
                selectedTab.classList.add('active');
                selectedContent.classList.add('active');
                console.log(`Tab ${tabId} activated successfully`);
            } else {
                console.error(`Tab or content not found for tabId: ${tabId}`);
            }
        }

        function showSection(section) {
        const registerSection = document.getElementById('register-section');
        const loginSection = document.getElementById('login-section');
        const productosSection = document.getElementById('productos-section');
        const entidadesSection = document.getElementById('entidades-section');
        const cloudwordsSection = document.getElementById('cloudwords-section');
        const lemmatizeSection = document.getElementById('lemmatize-section');
        const rpaSection = document.getElementById('rpa-section');
        const scrapingSection = document.getElementById('scraping-section');
        
        const productosBtn = document.getElementById('productos-btn');
        const entidadesBtn = document.getElementById('entidades-btn');
        const cloudwordsBtn = document.getElementById('cloudwords-btn');
        const lemmatizeBtn = document.getElementById('lemmatize-btn');
        const rpaBtn = document.getElementById('rpa-btn');
        const scrapingBtn = document.getElementById('scraping-btn');
        
        productosBtn.classList.remove('active');
        entidadesBtn.classList.remove('active');
        cloudwordsBtn.classList.remove('active');
        lemmatizeBtn.classList.remove('active');
        rpaBtn.classList.remove('active');
        scrapingBtn.classList.remove('active');

        registerSection.classList.remove('active');
        loginSection.classList.remove('active');
        productosSection.classList.remove('active');
        entidadesSection.classList.remove('active');
        cloudwordsSection.classList.remove('active');
        lemmatizeSection.classList.remove('active');
        rpaSection.classList.remove('active');
        scrapingSection.classList.remove('active');
        
        if (section === 'register') {
            registerSection.classList.add('active');
        } else if (section === 'login') {
            loginSection.classList.add('active');
        } else if (section === 'productos') {
            productosSection.classList.add('active');
            productosBtn.classList.add('active');
            initializeProductosTabs();
        } else if (section === 'entidades') {
            entidadesSection.classList.add('active');
            entidadesBtn.classList.add('active');
            getEntidades();
        } else if (section === 'cloudwords') {
            cloudwordsSection.classList.add('active');
            cloudwordsBtn.classList.add('active');
        } else if (section === 'lemmatize') {
            lemmatizeSection.classList.add('active');
            lemmatizeBtn.classList.add('active');
        } else if (section === 'rpa') {
            rpaSection.classList.add('active');
            rpaBtn.classList.add('active');
        } else if (section === 'scraping') {
            scrapingSection.classList.add('active');
            scrapingBtn.classList.add('active');
        }
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }
            

        // Mejorar la funci√≥n fetchWithRefresh
async function fetchWithRefresh(url, options = {}) {
    options.headers = options.headers || {};
    if (accessToken) {
        options.headers['Authorization'] = `Bearer ${accessToken}`;
    }
    
    try {
        const response = await fetch(url, options);
        if (response.status === 401) {
            console.log("Token expirado, intentando renovar...");
            const refreshed = await refreshAccessToken();
            if (refreshed) {
                options.headers['Authorization'] = `Bearer ${accessToken}`;
                return await fetch(url, options);
            }
            // Si no se pudo renovar, redirigir al login
            showSection('login');
            throw new Error('Sesi√≥n expirada. Por favor inicie sesi√≥n nuevamente.');
        }
        return response;
    } catch (error) {
        console.error("Error en fetchWithRefresh:", error);
        throw error;
    }
}

// Mejorar la funci√≥n de login
async function login() {
    const email = document.getElementById('login-email').value.trim();
    const password = document.getElementById('login-password').value.trim();
    
    if (!email || !password) {
        showAlert('login-result', 'Email y contrase√±a son requeridos', 'error');
        return;
    }
    if (!email.includes('@') || !email.includes('.')) {
        showAlert('login-result', 'Formato de email inv√°lido', 'error');
        return;
    }

    try {
        showAlert('login-result', 'Iniciando sesi√≥n...', 'success');
        
        const response = await fetch('http://127.0.0.1:8000/token', {
            method: 'POST',
            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
            body: `username=${encodeURIComponent(email)}&password=${encodeURIComponent(password)}`
        });
        
        if (!response.ok) {
            const errorData = await response.json().catch(() => ({}));
            const errorMessage = errorData.detail || 'Error desconocido al iniciar sesi√≥n';
            throw new Error(errorMessage);
        }
        
        const data = await response.json();
        accessToken = data.access_token;
        localStorage.setItem('accessToken', data.access_token);
        localStorage.setItem('refreshToken', data.refresh_token);
        showAlert('login-result', 'Inicio de sesi√≥n exitoso', 'success');
        document.getElementById('main-nav').style.display = 'flex';
        checkUser();
    } catch (error) {
        console.error('Error al iniciar sesi√≥n:', error);
        showAlert('login-result', `Error: ${error.message}`, 'error');
    }
}

// Mejorar la funci√≥n checkUser
async function checkUser() {
    if (!accessToken) {
        showSection('register');
        document.getElementById('main-nav').style.display = 'none';
        return;
    }

    try {
        const response = await fetchWithRefresh('http://127.0.0.1:8000/users/me');
        if (!response.ok) {
            const errorData = await response.json().catch(() => ({}));
            throw new Error(errorData.detail || 'Error al verificar usuario');
        }
        
        const user = await response.json();
        document.getElementById('main-nav').style.display = 'flex';
        document.getElementById('profile-btn').innerHTML = `<i class="fa-solid fa-user"></i> ${user.email.split('@')[0]}`;
        showSection('productos');
    } catch (error) {
        console.error('Error al verificar usuario:', error);
        logout();
    }
}

// Inicializaci√≥n de la aplicaci√≥n al cargar
document.addEventListener('DOMContentLoaded', function() {
    // Inicializar la aplicaci√≥n
    checkUser();
    
    // Manejo de errores no capturados en promesas
    window.addEventListener('unhandledrejection', function(event) {
        console.error('Unhandled promise rejection:', event.reason);
        showAlert('login-result', 'Error de conexi√≥n al servidor. Verifique que el backend est√© en ejecuci√≥n.', 'error');
    });
    
    // Forzar que la secci√≥n de registro sea visible inicialmente si no hay secciones mostradas
    setTimeout(function() {
        const activeSections = document.querySelectorAll('.content-section.active');
        if (activeSections.length === 0) {
            showSection('register');
        }
    }, 500);
});

        // A√±adir estas funciones al archivo JavaScript

// Funci√≥n para cambiar los par√°metros seg√∫n la aplicaci√≥n seleccionada
document.addEventListener('DOMContentLoaded', function() {
    // Solo ejecutar si estamos en la secci√≥n RPA (verificar si los elementos existen)
    if (document.getElementById('office-app')) {
        // Agregar event listeners para los radio buttons de aplicaciones
        const officeAppRadios = document.querySelectorAll('input[name="office-app"]');
        officeAppRadios.forEach(radio => {
            radio.addEventListener('change', updateOfficeParameters);
        });
        
        // Event listeners para cambiar opciones basadas en tipo de acci√≥n
        const officeActionRadios = document.querySelectorAll('input[name="office-action"]');
        officeActionRadios.forEach(radio => {
            radio.addEventListener('change', updateOfficeParameters);
        });
        
        // Actualizar par√°metros iniciales
        updateOfficeParameters();
    }
});

function updateOfficeParameters() {
    // Obtener la aplicaci√≥n seleccionada
    const selectedApp = document.querySelector('input[name="office-app"]:checked').value;
    const selectedAction = document.querySelector('input[name="office-action"]:checked').value;
    
    // Ocultar todos los conjuntos de par√°metros
    document.getElementById('excel-parameters').style.display = 'none';
    document.getElementById('word-parameters').style.display = 'none';
    document.getElementById('powerpoint-parameters').style.display = 'none';
    
    // Mostrar los par√°metros correspondientes a la aplicaci√≥n seleccionada
    document.getElementById(`${selectedApp}-parameters`).style.display = 'block';
    
    // Ajustar placeholder del campo de ruta seg√∫n la acci√≥n
    const filePathInput = document.getElementById('office-file-path');
    if (selectedAction === 'open' || selectedAction === 'edit') {
        filePathInput.placeholder = 'Ruta del archivo (obligatorio)';
        filePathInput.required = true;
    } else {
        filePathInput.placeholder = 'Ruta donde guardar (opcional)';
        filePathInput.required = false;
    }
}

// Funci√≥n para ejecutar la automatizaci√≥n de Office
async function executeOfficeAutomation() {
    // Obtener los valores de los campos
    const selectedApp = document.querySelector('input[name="office-app"]:checked').value;
    const selectedAction = document.querySelector('input[name="office-action"]:checked').value;
    const filePath = document.getElementById('office-file-path').value.trim();
    
    // Validaci√≥n b√°sica
    if ((selectedAction === 'open' || selectedAction === 'edit') && !filePath) {
        showAlert('office-automation-result', 'La ruta del archivo es obligatoria para abrir o editar', 'error');
        return;
    }
    
    // Recopilar par√°metros espec√≠ficos de la aplicaci√≥n
    let params = {
        app: selectedApp,
        action: selectedAction,
        file_path: filePath
    };
    
    // Recopilar par√°metros adicionales seg√∫n la aplicaci√≥n
    if (selectedApp === 'excel') {
        params.sheet_name = document.getElementById('excel-sheet-name').value.trim();
        params.data = document.getElementById('excel-data').value.trim();
    } else if (selectedApp === 'word') {
        params.content = document.getElementById('word-content').value.trim();
        params.template = document.getElementById('word-template').value.trim();
    } else if (selectedApp === 'powerpoint') {
        params.title = document.getElementById('powerpoint-title').value.trim();
        params.slides = document.getElementById('powerpoint-slides').value.trim();
    }
    
    // Mostrar indicador de carga
    showAlert('office-automation-result', 'Ejecutando automatizaci√≥n...', 'success');
    
    try {
        const response = await fetchWithRefresh('http://127.0.0.1:8000/rpa/office-automation', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(params)
        });
        
        if (!response.ok) {
            const errorText = await response.text();
            throw new Error(errorText);
        }
        
        const result = await response.json();
        
        // Mostrar resultado
        showAlert('office-automation-result', `Automatizaci√≥n completada: ${result.message}`, 'success');
        
        // Mostrar detalles si existen
        if (result.details) {
            const detailsDiv = document.createElement('div');
            detailsDiv.classList.add('producto-card');
            detailsDiv.style.marginTop = '15px';
            detailsDiv.innerHTML = `
                <h3>Detalles de la ejecuci√≥n:</h3>
                <pre style="white-space: pre-wrap; font-family: monospace; color: #ddd; background: rgba(0,0,0,0.3); padding: 10px; border-radius: 5px; max-height: 300px; overflow-y: auto;">${result.details}</pre>
            `;
            
            const resultContainer = document.getElementById('office-automation-result');
            resultContainer.parentNode.insertBefore(detailsDiv, resultContainer.nextSibling);
        }
    } catch (error) {
        console.error('Error en automatizaci√≥n de Office:', error);
        showAlert('office-automation-result', `Error: ${error.message}`, 'error');
    }
}

        async function register() {
            const email = document.getElementById('register-email').value.trim();
            const password = document.getElementById('register-password').value.trim();
            
            if (!email || !password) {
                showAlert('register-result', 'Email y contrase√±a son requeridos', 'error');
                return;
            }

            try {
                const response = await fetch('http://127.0.0.1:8000/register', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });
                if (!response.ok) throw new Error(await response.text());
                const result = await response.json();
                showAlert('register-result', result.mensaje, 'success');
                showSection('login');
            } catch (error) {
                console.error('Error al registrar:', error);
                showAlert('register-result', `Error: ${error.message}`, 'error');
            }
        }

        async function login() {
            const email = document.getElementById('login-email').value.trim();
            const password = document.getElementById('login-password').value.trim();
            
            if (!email || !password) {
                showAlert('login-result', 'Email y contrase√±a son requeridos', 'error');
                return;
            }
            if (!email.includes('@') || !email.includes('.')) {
                showAlert('login-result', 'Formato de email inv√°lido', 'error');
                return;
            }

            try {
                const response = await fetch('http://127.0.0.1:8000/token', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                    body: `username=${encodeURIComponent(email)}&password=${encodeURIComponent(password)}`
                });
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(errorText || 'Error desconocido al iniciar sesi√≥n');
                }
                const data = await response.json();
                accessToken = data.access_token;
                localStorage.setItem('accessToken', data.access_token);
                localStorage.setItem('refreshToken', data.refresh_token);
                showAlert('login-result', 'Inicio de sesi√≥n exitoso', 'success');
                document.getElementById('main-nav').style.display = 'flex';
                checkUser();
            } catch (error) {
                console.error('Error al iniciar sesi√≥n:', error);
                showAlert('login-result', `Error: ${error.message}`, 'error');
            }
        }

        async function refreshAccessToken() {
            const refreshToken = localStorage.getItem('refreshToken');
            if (!refreshToken) {
                logout();
                return false;
            }

            try {
                const response = await fetch('http://127.0.0.1:8000/refresh', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ refresh_token: refreshToken })
                });
                if (!response.ok) throw new Error(await response.text());
                const data = await response.json();
                accessToken = data.access_token;
                localStorage.setItem('accessToken', data.access_token);
                localStorage.setItem('refreshToken', data.refresh_token);
                return true;
            } catch (error) {
                console.error('Error al renovar token:', error);
                logout();
                return false;
            }
        }

        function logout() {
            accessToken = null;
            localStorage.removeItem('accessToken');
            localStorage.removeItem('refreshToken');
            document.getElementById('main-nav').style.display = 'none';
            showSection('register');
        }

        async function initializeProductosTabs() {
            const tabsElement = document.getElementById('productos-tabs');
            const listElement = document.getElementById('productos-list');
            listElement.innerHTML = '<p>Selecciona una colecci√≥n para ver los productos.</p>';
            tabsElement.innerHTML = '';

            try {
                const response = await fetchWithRefresh(`${API_BASE_PRODUCTOS}/`, { cache: 'no-store' });
                if (!response.ok) throw new Error(await response.text());
                const productos = await response.json();

                if (!Array.isArray(productos) || productos.length === 0) {
                    tabsElement.innerHTML = '';
                    listElement.innerHTML = '<p>No hay productos registrados</p>';
                    return;
                }

                const productosPorColeccion = {};
                productos.forEach(p => {
                    const coleccion = p.coleccion || 'Sin colecci√≥n';
                    if (!productosPorColeccion[coleccion]) {
                        productosPorColeccion[coleccion] = [];
                    }
                    productosPorColeccion[coleccion].push(p);
                });

                let tabsHtml = '';
                let firstTab = true;
                for (const coleccion of Object.keys(productosPorColeccion)) {
                    const safeColeccion = generateSafeId(coleccion);
                    const tabId = `productos-tab-${safeColeccion}`;
                    tabsHtml += `<button class="tab ${firstTab ? 'active' : ''}" data-tab-id="${tabId}" onclick="loadProductosTab('${coleccion}', '${tabId}')">${coleccion} (${productosPorColeccion[coleccion].length})</button>`;
                    firstTab = false;
                }

                tabsElement.innerHTML = tabsHtml;
            } catch (error) {
                console.error('Error al inicializar pesta√±as de productos:', error);
                showAlert('productos-list', `Error: ${error.message}`, 'error');
            }
        }

        async function loadProductosTab(coleccion, tabId) {
            const listElement = document.getElementById('productos-list');
            listElement.innerHTML = '<p>Cargando...</p>';

            try {
                const response = await fetchWithRefresh(`${API_BASE_PRODUCTOS}/`, { cache: 'no-store' });
                if (!response.ok) throw new Error(await response.text());
                const productos = await response.json();

                const productosPorColeccion = {};
                productos.forEach(p => {
                    const col = p.coleccion || 'Sin colecci√≥n';
                    if (!productosPorColeccion[col]) {
                        productosPorColeccion[col] = [];
                    }
                    productosPorColeccion[col].push(p);
                });

                const items = productosPorColeccion[coleccion] || [];
                let itemsHtml = items.length > 0 ? '' : '<p>No hay productos en esta colecci√≥n</p>';
                items.forEach(p => {
                    const price = p.price !== undefined ? p.price.toFixed(2) : 'No especificado';
                    itemsHtml += `
                        <div class="producto-card">
                            <div>
                                <p><strong>Nombre:</strong> ${p.name || 'Sin nombre'}</p>
                                <p><strong>Descripci√≥n:</strong> ${p.description || 'Sin descripci√≥n'}</p>
                                <p><strong>Precio:</strong> $${price}</p>
                                <p><small>ID: ${p._id || 'Sin ID'}</small></p>
                            </div>
                            <div>
                                <button onclick="editProducto('${p._id}', '${p.name || ''}', '${p.description || ''}', '${p.price || ''}', '${p.coleccion || ''}')">Editar</button>
                                <button class="back" onclick="deleteProducto('${p._id}', '${p.coleccion || ''}')">Eliminar</button>
                            </div>
                        </div>
                    `;
                });

                const contentHtml = `
                    <div id="${tabId}" class="tab-content active">
                        ${itemsHtml}
                    </div>
                `;
                listElement.innerHTML = contentHtml;
                showTab('productos', tabId);
            } catch (error) {
                console.error('Error al cargar productos:', error);
                showAlert('productos-list', `Error: ${error.message}`, 'error');
            }
        }

        async function createProducto() {
            const producto = {
                name: document.getElementById('create-product-name').value.trim(),
                description: document.getElementById('create-product-description').value.trim(),
                price: parseFloat(document.getElementById('create-product-price').value) || 0
            };
            
            if (!producto.name) {
                showAlert('create-product-result', 'Nombre es requerido', 'error');
                return;
            }
            
            try {
                const response = await fetchWithRefresh(`${API_BASE_PRODUCTOS}/`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(producto)
                });
                if (!response.ok) throw new Error(await response.text());
                const result = await response.json();
                showAlert('create-product-result', `${result.mensaje}`, 'success');
                document.getElementById('create-product-name').value = '';
                document.getElementById('create-product-description').value = '';
                document.getElementById('create-product-price').value = '';
                initializeProductosTabs();
            } catch (error) {
                console.error('Error al crear producto:', error);
                showAlert('create-product-result', `Error: ${error.message}`, 'error');
            }
        }

        function editProducto(id, name, description, price, coleccion) {
            document.getElementById('create-product-name').value = name;
            document.getElementById('create-product-description').value = description;
            document.getElementById('create-product-price').value = price === 'No especificado' ? '0' : price;
            const createButton = document.querySelector('#create-product-result').previousElementSibling;
            createButton.textContent = 'Actualizar Producto';
            createButton.onclick = () => updateProducto(id, coleccion);
        }

        async function updateProducto(id, coleccion) {
            const producto = {
                name: document.getElementById('create-product-name').value.trim(),
                description: document.getElementById('create-product-description').value.trim(),
                price: parseFloat(document.getElementById('create-product-price').value) || 0
            };
            
            try {
                const response = await fetchWithRefresh(`${API_BASE_PRODUCTOS}/${id}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(producto)
                });
                if (!response.ok) throw new Error(await response.text());
                const result = await response.json();
                showAlert('create-product-result', `${result.mensaje}`, 'success');
                document.getElementById('create-product-name').value = '';
                document.getElementById('create-product-description').value = '';
                document.getElementById('create-product-price').value = '';
                const createButton = document.querySelector('#create-product-result').previousElementSibling;
                createButton.textContent = 'Crear Producto';
                createButton.onclick = createProducto;
                initializeProductosTabs();
            } catch (error) {
                console.error('Error al actualizar producto:', error);
                showAlert('create-product-result', `Error: ${error.message}`, 'error');
            }
        }

        async function deleteProducto(id, coleccion) {
            if (!confirm('¬øEst√°s seguro de eliminar este producto?')) return;
            
            console.log(`Intentando eliminar producto con ID: ${id} de la colecci√≥n: ${coleccion}`);
            try {
                const response = await fetchWithRefresh(`${API_BASE_PRODUCTOS}/${id}?coleccion=${encodeURIComponent(coleccion || 'productos')}`, {
                    method: 'DELETE'
                });
                const responseData = await response.json();
                if (!response.ok) {
                    console.error('Respuesta de error del backend:', responseData);
                    throw new Error(responseData.detail || 'Error desconocido al eliminar el producto');
                }
                
                console.log('Respuesta del backend:', responseData);
                showAlert('productos-list', `${responseData.mensaje}`, 'success');
                initializeProductosTabs();
            } catch (error) {
                console.error('Error al eliminar producto:', error.message);
                showAlert('productos-list', `Error: ${error.message}`, 'error');
            }
        }

        async function getEntidades() {
            const tabsElement = document.getElementById('entidades-tabs');
            const listElement = document.getElementById('entidades-list');
            listElement.innerHTML = '<p>Selecciona una colecci√≥n para ver las entidades.</p>';
            tabsElement.innerHTML = '';

            try {
                const responseColecciones = await fetchWithRefresh(`${API_BASE_ENTIDADES}/`);
                if (!responseColecciones.ok) throw new Error(await responseColecciones.text());
                const colecciones = await responseColecciones.json();

                console.log('Colecciones recibidas:', colecciones);

                if (!Array.isArray(colecciones) || colecciones.length === 0) {
                    tabsElement.innerHTML = '';
                    listElement.innerHTML = '<p>No hay colecciones registradas</p>';
                    return;
                }

                let tabsHtml = '';
                for (const coleccion of colecciones) {
                    const responseEntidades = await fetchWithRefresh(`${API_BASE_ENTIDADES}/${coleccion}`);
                    const entidades = await responseEntidades.json();

                    console.log(`Entidades para ${coleccion}:`, entidades);

                    const safeColeccion = generateSafeId(coleccion);
                    const tabId = `entidades-tab-${safeColeccion}`;
                    tabsHtml += `<button class="tab" data-tab-id="${tabId}" onclick="loadEntidadesTab('${coleccion}', '${tabId}')">${coleccion} (${entidades.length})</button>`;
                }

                tabsElement.innerHTML = tabsHtml;
            } catch (error) {
                console.error('Error al obtener colecciones:', error);
                showAlert('entidades-list', `Error: ${error.message}`, 'error');
            }
        }

        async function loadEntidadesTab(coleccion, tabId) {
            const listElement = document.getElementById('entidades-list');
            listElement.innerHTML = '<p>Cargando...</p>';

            try {
                const response = await fetchWithRefresh(`${API_BASE_ENTIDADES}/${coleccion}`);
                if (!response.ok) throw new Error(await response.text());
                const entidades = await response.json();

                let itemsHtml = entidades.length > 0 ? '' : '<p>No hay entidades en esta colecci√≥n</p>';
                entidades.forEach(e => {
                    itemsHtml += `
                        <div>
                            <div>
                                <p><strong>Nombre:</strong> ${e.name || 'Sin nombre'}</p>
                                <p><strong>Descripci√≥n:</strong> ${e.description || 'Sin descripci√≥n'}</p>
                                <p><small>ID: ${e._id}</small></p>
                            </div>
                            <div>
                                <button onclick="editEntidad('${e._id}', '${e.name || ''}', '${e.description || ''}', '${coleccion}')">Editar</button>
                                <button class="back" onclick="deleteEntidad('${e._id}', '${coleccion}')">Eliminar</button>
                            </div>
                        </div>
                    `;
                });

                const contentHtml = `
                    <div id="${tabId}" class="tab-content active">
                        <div class="entidad-chip">
                            ${itemsHtml}
                            <button class="back" onclick="deleteColeccion('${coleccion}')">Eliminar Colecci√≥n</button>
                        </div>
                    </div>
                `;
                listElement.innerHTML = contentHtml;
                showTab('entidades', tabId);
            } catch (error) {
                console.error('Error al cargar entidades:', error);
                showAlert('entidades-list', `Error: ${error.message}`, 'error');
            }
        }

        async function createEntidad() {
            const coleccion = document.getElementById('entity-collection').value.trim().toLowerCase();
            const entidad = {
                name: document.getElementById('entity-name').value.trim(),
                description: document.getElementById('create-entity-description').value.trim()
            };
            
            if (!coleccion || !entidad.name) {
                showAlert('create-entity-result', 'Colecci√≥n y nombre son requeridos', 'error');
                return;
            }
            
            try {
                const response = await fetchWithRefresh(`${API_BASE_ENTIDADES}/${coleccion}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(entidad)
                });
                if (!response.ok) throw new Error(await response.text());
                const result = await response.json();
                showAlert('create-entity-result', `${result.mensaje}`, 'success');
                document.getElementById('entity-collection').value = '';
                document.getElementById('entity-name').value = '';
                document.getElementById('create-entity-description').value = '';
                getEntidades();
            } catch (error) {
                console.error('Error al crear entidad:', error);
                showAlert('create-entity-result', `Error: ${error.message}`, 'error');
            }
        }

        function editEntidad(id, name, description, coleccion) {
            document.getElementById('entity-collection').value = coleccion;
            document.getElementById('entity-name').value = name;
            document.getElementById('create-entity-description').value = description;
            const createButton = document.querySelector('#create-entity-result').previousElementSibling;
            createButton.textContent = 'Actualizar Entidad';
            createButton.onclick = () => updateEntidad(id, coleccion);
        }

        async function updateEntidad(id, coleccion) {
            const entidad = {
                name: document.getElementById('entity-name').value.trim(),
                description: document.getElementById('create-entity-description').value.trim()
            };
            
            try {
                const response = await fetchWithRefresh(`${API_BASE_ENTIDADES}/${coleccion}/${id}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(entidad)
                });
                if (!response.ok) throw new Error(await response.text());
                const result = await response.json();
                showAlert('create-entity-result', `${result.mensaje}`, 'success');
                document.getElementById('entity-collection').value = '';
                document.getElementById('entity-name').value = '';
                document.getElementById('create-entity-description').value = '';
                const createButton = document.querySelector('#create-entity-result').previousElementSibling;
                createButton.textContent = 'Crear Registro';
                createButton.onclick = createEntidad;
                getEntidades();
            } catch (error) {
                console.error('Error al actualizar entidad:', error);
                showAlert('create-entity-result', `Error: ${error.message}`, 'error');
            }
        }

        async function deleteEntidad(id, coleccion) {
            if (!confirm('¬øEst√°s seguro de eliminar esta entidad?')) return;

            console.log(`Intentando eliminar entidad con ID: ${id} de la colecci√≥n: ${coleccion}`);
            try {
                const response = await fetchWithRefresh(`${API_BASE_ENTIDADES}/${coleccion}/${id}`, {
                    method: 'DELETE'
                });
                const responseData = await response.json();
                if (!response.ok) {
                    console.error('Respuesta de error del backend:', responseData);
                    throw new Error(responseData.detail || 'Error desconocido al eliminar la entidad');
                }
                
                console.log('Respuesta del backend:', responseData);
                showAlert('entidades-list', `${responseData.mensaje}`, 'success');
                getEntidades();
            } catch (error) {
                console.error('Error al eliminar entidad:', error.message);
                showAlert('entidades-list', `Error: ${error.message}`, 'error');
            }
        }

        async function deleteColeccion(coleccion) {
            if (!confirm(`¬øEst√°s seguro de eliminar la colecci√≥n "${coleccion}"?`)) return;
            
            try {
                const response = await fetchWithRefresh(`${API_BASE_ENTIDADES}/${coleccion}`, {
                    method: 'DELETE'
                });
                if (!response.ok) throw new Error(await response.text());
                const result = await response.json();
                showAlert('entidades-list', `${result.mensaje}`, 'success');
                getEntidades();
            } catch (error) {
                console.error('Error al eliminar colecci√≥n:', error);
                showAlert('entidades-list', `Error: ${error.message}`, 'error');
            }
        }

        async function scrapeWebsite() {
            const url = document.getElementById('scrape-url').value.trim();

            if (!url) {
                showAlert('scrape-result', 'La URL es requerida', 'error');
                return;
            }

            try {
                const response = await fetchWithRefresh(`http://127.0.0.1:8000/scraping/?url=${encodeURIComponent(url)}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                if (!response.ok) throw new Error(await response.text());

                const blob = await response.blob();
                const contentDisposition = response.headers.get('Content-Disposition');
                const filenameMatch = contentDisposition && contentDisposition.match(/filename="(.+)"/);
                const filename = filenameMatch ? filenameMatch[1] : 'scraped_data.xlsx';

                const link = document.createElement('a');
                link.href = window.URL.createObjectURL(blob);
                link.download = filename;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);

                showAlert('scrape-result', 'Datos scrapeados y descargados exitosamente', 'success');
            } catch (error) {
                console.error('Error al scrapear:', error);
                showAlert('scrape-result', `Error: ${error.message}`, 'error');
            }
        }

        // Reemplaza esta funci√≥n en tu cliente-api.html
async function generateWordcloud() {
    const text = document.getElementById('cloudwords-text').value.trim();
    if (!text) {
        showAlert('cloudwords-result', 'El texto es requerido', 'error');
        return;
    }
    
    // Mostrar indicador de carga
    document.getElementById('cloudwords-result').innerHTML = 'Generando nube de palabras...';
    
    try {
        const response = await fetchWithRefresh('http://127.0.0.1:8000/cloudwords/generate', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ 
                text: text,
                language: "spanish",
                title: "Nube de Palabras",
                width: 800,
                height: 400
            })
        });
        
        if (!response.ok) {
            const errorText = await response.text();
            throw new Error(errorText);
        }
        
        // Convertir la respuesta en un blob de imagen
        const blob = await response.blob();
        const url = window.URL.createObjectURL(blob);
        
        // Crear o actualizar la imagen en el contenedor
        const resultContainer = document.getElementById('cloudwords-result-container');
        resultContainer.innerHTML = `
            <div class="producto-card">
                <h3>Nube de Palabras Generada</h3>
                <img src="${url}" alt="Nube de Palabras" style="max-width: 100%; height: auto; margin-top: 10px; border-radius: 8px;">
                <div style="margin-top: 15px; display: flex; justify-content: space-between;">
                    <button onclick="downloadImage('${url}', 'nube_palabras.png')" style="width: 48%;">
                        <i class="fa-solid fa-download"></i> Descargar
                    </button>
                    <button onclick="generateNewWordcloud()" class="back" style="width: 48%;">
                        <i class="fa-solid fa-refresh"></i> Nueva Nube
                    </button>
                </div>
            </div>
        `;
        
        showAlert('cloudwords-result', 'Nube de palabras generada exitosamente', 'success');
    } catch (error) {
        console.error('Error al generar nube de palabras:', error);
        showAlert('cloudwords-result', `Error: ${error.message}`, 'error');
    }
}

// Funci√≥n auxiliar para descargar la imagen
function downloadImage(url, filename) {
    const a = document.createElement('a');
    a.style.display = 'none';
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
}

// Funci√≥n para generar una nueva nube (limpia el √°rea de resultados)
function generateNewWordcloud() {
    document.getElementById('cloudwords-result-container').innerHTML = '';
    document.getElementById('cloudwords-text').focus();
}

        
        
        async function generateWordcloudCollection() {
            const coleccion = document.getElementById('cloudwords-collection').value.trim();
            const campo = document.getElementById('cloudwords-field').value.trim();
            
            if (!coleccion) {
                showAlert('cloudwords-result', 'La colecci√≥n es requerida', 'error');
                return;
            }
            
            try {
                const response = await fetchWithRefresh(`http://127.0.0.1:8000/cloudwords/collection/${coleccion}?campo=${encodeURIComponent(campo)}`, {
                    method: 'GET'
                });
                
                if (!response.ok) throw new Error(await response.text());
                
                // Descargar la imagen de nube de palabras
                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.style.display = 'none';
                a.href = url;
                a.download = `nube_palabras_${coleccion}_${campo}.png`;
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
                
                showAlert('cloudwords-result', 'Nube de palabras generada exitosamente', 'success');
            } catch (error) {
                console.error('Error al generar nube de palabras:', error);
                showAlert('cloudwords-result', `Error: ${error.message}`, 'error');
            }
        }
        
        // Nuevas funciones para Lematizaci√≥n
        async function lemmatizeText() {
            const text = document.getElementById('lemmatize-text').value.trim();
            const language = document.getElementById('lemmatize-language').value;
            const removeStopwords = document.getElementById('lemmatize-remove-stopwords').checked;
            
            if (!text) {
                showAlert('lemmatize-result', 'El texto es requerido', 'error');
                return;
            }
            
            try {
                const response = await fetchWithRefresh('http://127.0.0.1:8000/lemmatization/', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        text,
                        language,
                        remove_stopwords: removeStopwords
                    })
                });
                
                if (!response.ok) throw new Error(await response.text());
                
                const result = await response.json();
                
                // Mostrar resultado
                const resultContainer = document.getElementById('lemmatize-result-container');
                resultContainer.innerHTML = `
                    <div class="producto-card">
                        <p><strong>Texto original (${result.tokens_count} tokens):</strong></p>
                        <p>${result.original_text}</p>
                        <hr style="border-color: #0ef; margin: 10px 0;">
                        <p><strong>Texto lematizado:</strong></p>
                        <p>${result.lemmatized_text}</p>
                    </div>
                `;
                
                showAlert('lemmatize-result', 'Texto lematizado exitosamente', 'success');
            } catch (error) {
                console.error('Error al lematizar texto:', error);
                showAlert('lemmatize-result', `Error: ${error.message}`, 'error');
            }
        }
        
        async function analyzeCollection() {
            const coleccion = document.getElementById('lemmatize-collection').value.trim();
            const campo = document.getElementById('lemmatize-field').value.trim();
            const language = document.getElementById('lemmatize-collection-language').value;
            const removeStopwords = document.getElementById('lemmatize-collection-remove-stopwords').checked;
            
            if (!coleccion) {
                showAlert('lemmatize-collection-result', 'La colecci√≥n es requerida', 'error');
                return;
            }
            
            try {
                const response = await fetchWithRefresh(`http://127.0.0.1:8000/lemmatization/analyze-collection?coleccion=${encodeURIComponent(coleccion)}&campo=${encodeURIComponent(campo)}&language=${encodeURIComponent(language)}&remove_stopwords=${removeStopwords}`, {
                    method: 'POST'
                });
                
                if (!response.ok) throw new Error(await response.text());
                
                const result = await response.json();
                
                // Mostrar resultado
                const resultContainer = document.getElementById('lemmatize-collection-result-container');
                resultContainer.innerHTML = `
                    <div class="producto-card">
                        <p><strong>Colecci√≥n:</strong> ${result.coleccion}</p>
                        <p><strong>Campo:</strong> ${result.campo}</p>
                        <p><strong>Total de documentos:</strong> ${result.total_documentos}</p>
                        <p><strong>Documentos con texto:</strong> ${result.documentos_con_texto}</p>
                        <p><strong>Total de tokens originales:</strong> ${result.total_tokens_originales}</p>
                        <p><strong>Total de tokens lematizados:</strong> ${result.total_tokens_lematizados}</p>
                        <p><strong>Reducci√≥n:</strong> ${result.reduccion_porcentaje}%</p>
                        <p><strong>Tokens √∫nicos originales:</strong> ${result.tokens_unicos_originales}</p>
                        <p><strong>Tokens √∫nicos lematizados:</strong> ${result.tokens_unicos_lematizados}</p>
                        <p><strong>Muestra de tokens originales:</strong> ${result.muestra_tokens_originales.join(', ')}</p>
                        <p><strong>Muestra de tokens lematizados:</strong> ${result.muestra_tokens_lematizados.join(', ')}</p>
                    </div>
                `;
                
                showAlert('lemmatize-collection-result', 'Colecci√≥n analizada exitosamente', 'success');
            } catch (error) {
                console.error('Error al analizar colecci√≥n:', error);
                showAlert('lemmatize-collection-result', `Error: ${error.message}`, 'error');
            }
        }
        
        // Nuevas funciones para RPA
        async function checkRPADependencies() {
            try {
                const response = await fetchWithRefresh('http://127.0.0.1:8000/rpa/check-dependencies', {
                    method: 'GET'
                });
                
                if (!response.ok) throw new Error(await response.text());
                
                const result = await response.json();
                
                // Mostrar resultado
                const resultContainer = document.getElementById('rpa-dependencies-result');
                resultContainer.innerHTML = `
                    <div class="producto-card">
                        <p><strong>Estado:</strong> ${result.status}</p>
                        <p><strong>Python:</strong> ${result.python_version}</p>
                        <p><strong>Chrome:</strong> ${result.chrome_path || 'No encontrado'}</p>
                        <p><strong>ChromeDriver:</strong> ${result.chromedriver_path || 'No encontrado'}</p>
                        <p><strong>Selenium:</strong> ${result.selenium_version}</p>
                    </div>
                `;
                
                showAlert('rpa-result', 'Dependencias verificadas exitosamente', 'success');
            } catch (error) {
                console.error('Error al verificar dependencias:', error);
                showAlert('rpa-result', `Error: ${error.message}`, 'error');
            }
        }
        
        async function scrapeWebsiteRPA() {
            const url = document.getElementById('rpa-url').value.trim();
            const waitTime = parseInt(document.getElementById('rpa-wait-time').value) || 10;
            
            if (!url) {
                showAlert('rpa-result', 'La URL es requerida', 'error');
                return;
            }
            
            try {
                const response = await fetchWithRefresh('http://127.0.0.1:8000/rpa/scrape', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        url,
                        wait_time: waitTime
                    })
                });
                
                if (!response.ok) throw new Error(await response.text());
                
                // Descargar el archivo Excel
                const blob = await response.blob();
                const filename = response.headers.get('Content-Disposition').split('filename=')[1].replace(/"/g, '');
                const url_obj = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.style.display = 'none';
                a.href = url_obj;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url_obj);
                
                showAlert('rpa-result', 'Scraping automatizado completado exitosamente', 'success');
            } catch (error) {
                console.error('Error en scraping automatizado:', error);
                showAlert('rpa-result', `Error: ${error.message}`, 'error');
            }
        }
        
        async function executeDataEntry() {
            const collectionName = document.getElementById('rpa-collection-name').value.trim();
            const dataSource = document.getElementById('rpa-data-source').value.trim();
            
            if (!collectionName || !dataSource) {
                showAlert('rpa-data-entry-result', 'La colecci√≥n y la fuente de datos son requeridas', 'error');
                return;
            }
            
            try {
                const response = await fetchWithRefresh('http://127.0.0.1:8000/rpa/data-entry', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        collection_name: collectionName,
                        data_source: dataSource
                    })
                });
                
                if (!response.ok) throw new Error(await response.text());
                
                const result = await response.json();
                
                // Mostrar resultado
                showAlert('rpa-data-entry-result', `Datos insertados exitosamente: ${result.records_inserted} registros`, 'success');
            } catch (error) {
                console.error('Error en entrada de datos:', error);
                showAlert('rpa-data-entry-result', `Error: ${error.message}`, 'error');
            }
        }
        
        async function scheduleDataSync() {
            const sourceCollection = document.getElementById('rpa-source-collection').value.trim();
            const targetCollection = document.getElementById('rpa-target-collection').value.trim();
            const syncInterval = parseInt(document.getElementById('rpa-sync-interval').value) || 60;
            
            if (!sourceCollection || !targetCollection) {
                showAlert('rpa-data-sync-result', 'Las colecciones de origen y destino son requeridas', 'error');
                return;
            }
            
            try {
                const response = await fetchWithRefresh('http://127.0.0.1:8000/rpa/data-sync', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        source_collection: sourceCollection,
                        target_collection: targetCollection,
                        sync_interval_minutes: syncInterval
                    })
                });
                
                if (!response.ok) throw new Error(await response.text());
                
                const result = await response.json();
                
                // Mostrar resultado
                showAlert('rpa-data-sync-result', `Sincronizaci√≥n programada exitosamente: ID de tarea ${result.task_id}`, 'success');
            } catch (error) {
                console.error('Error al programar sincronizaci√≥n:', error);
                showAlert('rpa-data-sync-result', `Error: ${error.message}`, 'error');
            }
        }
    </script>
</body>
</html>